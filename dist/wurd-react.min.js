!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("react"),require("marked")):"function"==typeof define&&define.amd?define(["exports","react","marked"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).wurd={},t.React,t.marked)}(this,function(t,e,n){"use strict";function r(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var f=r(e),i=r(n);function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function c(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function u(t,e,n){return e&&a(t.prototype,e),n&&a(t,n),t}function s(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach(function(t){s(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function h(t,e){if(null==t)return{};var n,r,o=function(t,e){if(null==t)return{};var n,r,o={},i=Object.keys(t);for(r=0;r<i.length;r++)n=i[r],0<=e.indexOf(n)||(o[n]=t[n]);return o}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(r=0;r<i.length;r++)n=i[r],0<=e.indexOf(n)||Object.prototype.propertyIsEnumerable.call(t,n)&&(o[n]=t[n])}return o}var l=function(t){return!(null==t||"object"!==o(t)||Array.isArray(t))};var y=function(t,e){var n=t.length,r=-1;for(;++r<n;)if(e(t[r],r,t))return!0;return!1};var v=function(t,e){if(!l(t)||"string"!=typeof e)return t;var n=t;return y(e.split("."),function(t){if(!(n=n[t]))return!0}),n};var b=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};c(this,e),this.rawContent=t}return u(e,[{key:"get",value:function(t){return v(this.rawContent,t)}},{key:"setSections",value:function(t){Object.assign(this.rawContent,t)}}]),e}(),m=function(){function o(t,e){var n=this;c(this,o),this.wurd=t,this.path=e,this._get=t.store.get.bind(t.store),Object.getOwnPropertyNames(Object.getPrototypeOf(this)).forEach(function(t){n[t]=n[t].bind(n)})}return u(o,[{key:"id",value:function(t){return t?this.path?[this.path,t].join("."):t:this.path}},{key:"get",value:function(t){var e=this._get(this.id(t));if(void 0===e&&this.wurd.draft){var n=t.split(".")[0];this._get(n)||console.warn("Tried to access unloaded section: ".concat(n))}return e}},{key:"text",value:function(t,e){var n=this.get(t);return void 0===n?this.wurd.draft?"[".concat(t,"]"):"":"string"!=typeof n?(console.warn("Tried to get object as string: ".concat(t)),this.wurd.draft?"[".concat(t,"]"):""):(e&&(n=function(n,t){var r=1<arguments.length&&void 0!==t?t:{};return"string"!=typeof n||Object.keys(r).forEach(function(t){var e=r[t];n=n.replace(new RegExp("{{".concat(t,"}}"),"g"),e)}),n}(n,e)),n)}},{key:"markdown",value:function(t,e){return i.default(this.text(t,e))}},{key:"map",value:function(o,i){var c=this,t=this.get(o)||s({},Date.now(),{}),a=0;return Object.keys(t).sort().map(function(t){var e=a;a++;var n=[o,t].join("."),r=c.block(n);return i.call(void 0,r,e)})}},{key:"block",value:function(t,e){var n=this.id(t),r=new o(this.wurd,n);return"function"==typeof e?e.call(void 0,r):r}},{key:"el",value:function(t,e,n){var r=2<arguments.length&&void 0!==n?n:{},o=this.id(t),i=r.markdown?this.markdown(t,e):this.text(t,e),c=e||r.markdown?"data-wurd-md":"data-wurd";if(this.wurd.draft){var a=r.type||"span";return r.markdown&&(a="div"),"<".concat(a," ").concat(c,'="').concat(o,'">').concat(i,"</").concat(a,">")}return i}}]),o}(),w=function(){function r(t,e){var n=this;c(this,r),this.store=new b,this.content=new m(this,null),Object.getOwnPropertyNames(Object.getPrototypeOf(this.content)).forEach(function(t){n[t]=n.content[t].bind(n.content)}),this.connect(t,e)}return u(r,[{key:"connect",value:function(t,e){var n=this,r=1<arguments.length&&void 0!==e?e:{};switch(this.app=t,this.draft=!1,this.editMode=!1,["draft","lang","debug"].forEach(function(t){var e=r[t];void 0!==e&&(n[t]=e)}),r.editMode){case!0:this.startEditor();break;case"querystring":/[?&]edit(&|$)/.test(location.search)&&this.startEditor()}return r.rawContent&&this.store.setSections(r.rawContent),r.blockHelpers&&this.setBlockHelpers(r.blockHelpers),this}},{key:"load",value:function(c){var a=this,u=this.app,s=this.store,d=this.debug;return new Promise(function(e,n){if(!u)return n(new Error("Use wurd.connect(appName) before wurd.load()"));var t=s.get(c);if(t)return d&&console.info("from cache: ",c),e(t);d&&console.info("from server: ",c);var r,o=["draft","lang"].reduce(function(t,e){return a[e]&&(t[e]=a[e]),t},{}),i="".concat("https://api-v3.wurd.io","/apps/").concat(u,"/content/").concat(c,"?").concat((r=o,Object.keys(r).map(function(t){var e=r[t];return encodeURIComponent(t)+"="+encodeURIComponent(e)}).join("&")));return fetch(i).then(function(t){return t.json()}).then(function(t){if(t.error)throw t.error.message?new Error(t.error.message):new Error("Error loading ".concat(c));s.setSections(t),e(a.content)}).catch(function(t){return n(t)})})}},{key:"startEditor",value:function(){var t=this.app,e=this.lang;this.editMode=!0,this.draft=!0;var n=document.createElement("script");n.src="https://edit-v3.wurd.io/widget.js",n.async=!0,n.setAttribute("data-app",t),e&&n.setAttribute("data-lang",e),document.getElementsByTagName("body")[0].appendChild(n)}},{key:"setBlockHelpers",value:function(t){Object.assign(m.prototype,t)}}]),r}(),g=new w;function k(t){var e=t.block,n=t.id,r=t.sid,o=t.type,i=void 0===o?"span":o,c=t.component,a=void 0===c?i:c,u=t.vars,s=h(t,["block","id","sid","type","component","vars"]),d=(e=e||g.content).text(n,u),l=p({},s);g.editMode&&(l[u?"data-wurd-md":"data-wurd"]=e.id(r||n));return f.default.createElement(a,l,d)}function O(t){var e=t.block,n=t.id,r=t.sid,o=t.type,i=void 0===o?"div":o,c=t.component,a=void 0===c?i:c,u=t.vars,s=h(t,["block","id","sid","type","component","vars"]),d=(e=e||g.content).markdown(n,u,s),l=p(p({},s),{},{dangerouslySetInnerHTML:{__html:d}});return g.editMode&&(l["data-wurd-md"]=e.id(r||n)),f.default.createElement(a,l)}function j(t){var e=t.block,n=t.id,r=t.sid,o=h(t,["block","id","sid"]),i=(e=e||g.content).text(n),c=p(p({},o),{},{src:i});return g.editMode&&(c["data-wurd-img"]=e.id(r||n)),f.default.createElement("img",c)}function E(t){var e=t.block,n=t.id,r=t.children,o=t.type,i=void 0===o?"ul":o,c=t.component,a=void 0===c?i:c,u=t.keys,s=void 0===u?"title":u,d=h(t,["block","id","children","type","component","keys"]);e=e||g.content;var l=p({},d);return g.editMode&&(l["data-wurd-list"]=e.id(n),l["data-wurd-list-props"]=s),f.default.createElement(a,l,e.map(n,function(t,e){return r(t,e)}))}function P(t){var e=t.block,n=t.id,r=t.sid,o=t.keys,i=t.type,c=void 0===i?"span":i,a=t.component,u=void 0===a?c:a,s=t.children,d=h(t,["block","id","sid","keys","type","component","children"]);e=e||g.content;var l=p({},d);return g.editMode&&(l["data-wurd-obj"]=e.id(r||n),l["data-wurd-obj-props"]=Array.isArray(o)?o.join(","):o),f.default.createElement(u,l,s)}g.Wurd=w,g.setBlockHelpers({Text:function(t){return f.default.createElement(k,p({block:this},t))},Markdown:function(t){return f.default.createElement(O,p({block:this},t))},Image:function(t){return f.default.createElement(j,p({block:this},t))},List:function(t){return f.default.createElement(E,p({block:this},t))},Object:function(t){return f.default.createElement(P,p({block:this},t))}}),t.WurdImage=j,t.WurdList=E,t.WurdMarkdown=O,t.WurdObject=P,t.WurdText=k,t.default=g,Object.defineProperty(t,"__esModule",{value:!0})});
